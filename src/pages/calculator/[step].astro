---
/**
 * CALCULATOR STEP PAGE
 *
 * Dynamic routing for calculator steps.
 * Uses React CalculatorApp component with client-side hydration.
 */

import LayoutCalculator from '@/components/calculator/layout-calculator.astro';
import CalculatorApp from '@/components/calculator/CalculatorApp';
import { getStepById, CALCULATOR_STEPS } from '@/lib/core/calculator/config';

// Get step from URL
const { step } = Astro.params;

// Validate step - allow any step-XX format or redirect from index
const stepConfig = getStepById(step || '');

// For now, allow entry even if step not in config (we manage steps internally)
// The CalculatorApp component will handle the actual step rendering

export function getStaticPaths() {
  return CALCULATOR_STEPS.map((step) => ({
    params: { step: step.id },
  }));
}

// Get current step order for initial progress display
const stepOrder = stepConfig?.order || 1;
---

<LayoutCalculator
  title="Get Your Quote"
  description="Calculate your moving costs in minutes"
  currentStep={stepOrder}
>
  <!-- Calculator App with React hydration -->
  <CalculatorApp client:load />
</LayoutCalculator>
