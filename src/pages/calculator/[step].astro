---
/**
 * CALCULATOR STEP PAGE
 *
 * Dynamic routing for calculator steps.
 * Renders the appropriate step component based on URL.
 */

import LayoutCalculator from '@/components/calculator/layout-calculator.astro';
import { getStepById, CALCULATOR_STEPS } from '@/lib/core/calculator/config';

// Import all step components (default exports)
import Step1ServiceType from '@/components/calculator/steps/Step1ServiceType';
import Step2PropertySize from '@/components/calculator/steps/Step2PropertySize';
import Step2FurnitureOnly from '@/components/calculator/steps/Step2FurnitureOnly';
import Step3BelongingsSlider from '@/components/calculator/steps/Step3BelongingsSlider';
import Step4Recommendation from '@/components/calculator/steps/Step4Recommendation';
import Step5DateSelection from '@/components/calculator/steps/Step5DateSelection';
import Step6Complications from '@/components/calculator/steps/Step6Complications';
import Step7PropertyChain from '@/components/calculator/steps/Step7PropertyChain';
import Step8FromAddress from '@/components/calculator/steps/Step8FromAddress';
import Step9ToAddress from '@/components/calculator/steps/Step9ToAddress';
import Step10Extras from '@/components/calculator/steps/Step10Extras';
import Step11Contact from '@/components/calculator/steps/Step11Contact';
import Step12Quote from '@/components/calculator/steps/Step12Quote';

// Get step from URL
const { step } = Astro.params;

// Validate step
const stepConfig = getStepById(step || '');

if (!stepConfig) {
  return Astro.redirect('/404');
}

// Get step order for progress
const stepOrder = stepConfig.order;

export function getStaticPaths() {
  return CALCULATOR_STEPS.map((step) => ({
    params: { step: step.id },
  }));
}
---

<LayoutCalculator
  title={stepConfig.title.en}
  description={stepConfig.description?.en}
  currentStep={stepOrder}
>
  <!-- Calculator Step Component -->
  <div id="calculator-app" class="max-w-2xl mx-auto">
    {step === 'step-01' && <Step1ServiceType client:load />}
    {step === 'step-02' && <Step2PropertySize client:load />}
    {step === 'step-02b' && <Step2FurnitureOnly client:load />}
    {step === 'step-03' && <Step3BelongingsSlider client:load />}
    {step === 'step-04' && <Step4Recommendation client:load />}
    {step === 'step-05' && <Step5DateSelection client:load />}
    {step === 'step-06' && <Step6Complications client:load />}
    {step === 'step-07' && <Step7PropertyChain client:load />}
    {step === 'step-08' && <Step8FromAddress client:load />}
    {step === 'step-09' && <Step9ToAddress client:load />}
    {step === 'step-10' && <Step10Extras client:load />}
    {step === 'step-11' && <Step11Contact client:load />}
    {step === 'step-12' && <Step12Quote client:load />}
  </div>
</LayoutCalculator>
